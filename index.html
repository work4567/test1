<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Status Window</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="loadingScreen">
  <div id="loadingBarContainer">
    <div id="progressBar"></div>
  </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div id="mainContent" style="display:none;">
  <div class="card" id="systemCard">
    <h3>üü• –°–ò–°–¢–ï–ú–ê –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê</h3>
    <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ç–µ–ª–æ –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –ø—Ä–æ–∫–∞—á–∫–∏.<br>–§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∏–∂–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.</p>
  </div>
  <div class="button-container">
    <button onclick="acceptContract()">–ü—Ä–∏–Ω—è—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç</button>
    <button onclick="declineContract()">–ù–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å</button>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏
function generateCodeName() {
    let letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    let digits = Math.floor(Math.random() * 900) + 100; // 100-999
    let letter = letters[Math.floor(Math.random() * letters.length)];
    return `${letter}${digits}`;
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ localStorage
let user = JSON.parse(localStorage.getItem("userData"));

// –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
function animateLoading(callback) {
    let width = 0;
    let bar = document.getElementById("progressBar");
    let interval = setInterval(() => {
        width += 2; // –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –¥–æ–ª—å—à–µ
        bar.style.width = width + "%";
        if (width >= 100) {
            clearInterval(interval);
            document.getElementById("loadingScreen").style.display = "none";
            document.body.style.background = "#1e1e1e"; // –º–µ–Ω—è–µ–º —Ñ–æ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            callback();
        }
    }, 50); // –º–µ–¥–ª–µ–Ω–Ω–µ–µ
}

animateLoading(() => {
    if (user && user.acceptedContract) {
        showMainContent();
    } else {
        document.getElementById("mainContent").style.display = "block";
    }
});

// –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω (–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç + –∑–∞–¥–∞–Ω–∏—è)
function showMainContent() {
    if(!user) {
        user = {
            codeName: generateCodeName(),
            level: 1,
            resolve: 0,
            acceptedContract: true
        };
        localStorage.setItem("userData", JSON.stringify(user));
    }

    document.getElementById("mainContent").innerHTML = `
      <div class="card">
        <h3>üíª –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h3>
        <p>–ö–æ–¥–æ–≤–æ–µ –∏–º—è: ${user.codeName}<br>
           –£—Ä–æ–≤–µ–Ω—å: ${user.level}<br>
           Resolve: ${user.resolve}
        </p>
      </div>
      <div class="card">
        <h3>üß† –ó–∞–¥–∞–Ω–∏—è</h3>
        <p>üéØ –ó–∞–¥–∞–Ω–∏–µ: 10 –æ—Ç–∂–∏–º–∞–Ω–∏–π</p>
        <button onclick="completeTask()">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
      </div>
    `;
    document.getElementById("mainContent").style.display = "block";
}

// –ù–∞–∂–∞—Ç–∏–µ "–ü—Ä–∏–Ω—è—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç"
function acceptContract() {
    user = {
        codeName: generateCodeName(),
        level: 1,
        resolve: 0,
        acceptedContract: true
    };
    localStorage.setItem("userData", JSON.stringify(user));
    showMainContent();
}

// –ù–∞–∂–∞—Ç–∏–µ "–ù–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å"
function declineContract() {
    alert("–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –ø—Ä–∏–Ω—è—Ç. Mini App –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç.");
}

// –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
function completeTask() {
    user.resolve = (user.resolve || 0) + 3;
    localStorage.setItem("userData", JSON.stringify(user));
    alert("–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω. Resolve +3");
    showMainContent();
}
</script>

</body>
</html>

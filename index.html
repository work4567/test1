<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Status Window</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="loadingScreen">
  <div id="loadingBarContainer">
    <div id="progressBar"></div>
  </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div id="mainContent" style="display:none;"></div>

<!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
<div id="bottomNav" style="display:none;">
    <div class="navButton" id="tabCabinet" onclick="showTab('cabinet')">
        <img src="icons/user.png" alt="–ö–∞–±–∏–Ω–µ—Ç">
        –ö–∞–±–∏–Ω–µ—Ç
    </div>
    <div class="navButton" id="tabTasks" onclick="showTab('tasks')">
        <img src="icons/quest.png" alt="–ó–∞–¥–∞–Ω–∏—è">
        –ó–∞–¥–∞–Ω–∏—è
    </div>
    <div class="navButton" id="tabShop" onclick="showTab('shop')">
        <img src="icons/shop.png" alt="–ú–∞–≥–∞–∑–∏–Ω">
        –ú–∞–≥–∞–∑–∏–Ω
    </div>
    <div class="navButton" id="tabAchievements" onclick="showTab('achievements')">
        <img src="icons/trophy.png" alt="–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è">
        –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏
function generateCodeName() {
    let letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    let digits = Math.floor(Math.random() * 900) + 100;
    let letter = letters[Math.floor(Math.random() * letters.length)];
    return `${letter}${digits}`;
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ localStorage
let user = JSON.parse(localStorage.getItem("userData"));

// –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
function animateLoading(callback) {
    let width = 0;
    let bar = document.getElementById("progressBar");
    let interval = setInterval(() => {
        width += 2;
        bar.style.width = width + "%";
        if (width >= 100) {
            clearInterval(interval);
            document.getElementById("loadingScreen").style.display = "none";
            document.body.style.background = "#1e1e1e";
            callback();
        }
    }, 50);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
animateLoading(() => {
    if(user && user.acceptedContract){
        document.getElementById("bottomNav").style.display = "flex";
        showTab('tasks');
    } else {
        showContractScreen();
    }
});

// –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
function showContractScreen() {
    document.getElementById("mainContent").innerHTML = `
      <div class="card">
        <h3>üü• –°–ò–°–¢–ï–ú–ê –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê</h3>
        <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ç–µ–ª–æ –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –ø—Ä–æ–∫–∞—á–∫–∏.<br>–§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∏–∂–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.</p>
      </div>
      <div class="button-container">
        <button onclick="acceptContract()">–ü—Ä–∏–Ω—è—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç</button>
        <button onclick="declineContract()">–ù–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å</button>
      </div>
    `;
    document.getElementById("mainContent").style.display = "block";
}

// –ü—Ä–∏–Ω—è—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç
function acceptContract() {
    user = {
        codeName: generateCodeName(),
        level: 1,
        resolve: 0,
        xp: 0,
        acceptedContract: true,
        lastTaskDate: null
    };
    localStorage.setItem("userData", JSON.stringify(user));
    document.getElementById("bottomNav").style.display = "flex";
    showTab('tasks');
}

// –ù–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç
function declineContract() {
    alert("–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –ø—Ä–∏–Ω—è—Ç. Mini App –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç.");
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
function showTab(tab){
    document.querySelectorAll('.navButton').forEach(btn => btn.classList.remove('active'));
    let activeTab = document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1));
    if(activeTab) activeTab.classList.add('active');

    let content = '';
    switch(tab){
        case 'cabinet':
            content = `<div class="card">
                <h3>üíª –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h3>
                <p>–ö–æ–¥–æ–≤–æ–µ –∏–º—è: ${user.codeName}<br>
                   –£—Ä–æ–≤–µ–Ω—å: ${user.level}<br>
                   XP: ${user.xp}<br>
                   Resolve: ${user.resolve}
                </p>
            </div>`;
            break;
        case 'tasks':
            content = `<div class="card">
                <h3>üß† –ó–∞–¥–∞–Ω–∏—è</h3>
                <p>üéØ 10 –æ—Ç–∂–∏–º–∞–Ω–∏–π</p>
                <button onclick="completeTask()">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
            </div>`;
            break;
        case 'shop':
            content = `<div class="card">–ú–∞–≥–∞–∑–∏–Ω (–ø–æ–∫–∞ –ø—É—Å—Ç–æ)</div>`;
            break;
        case 'achievements':
            content = `<div class="card">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è (–ø–æ–∫–∞ –ø—É—Å—Ç–æ)</div>`;
            break;
    }
    document.getElementById("mainContent").innerHTML = content;
    document.getElementById("mainContent").style.display = "block";
}

// –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å
function completeTask() {
    let today = new Date().toISOString().slice(0,10);
    if(user.lastTaskDate === today){
        alert("–ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è");
        return;
    }
    user.resolve += 3;
    user.xp += 10;
    if(user.xp >= 100){
        user.level += 1;
        user.xp -= 100;
        alert("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω!");
    }
    user.lastTaskDate = today;
    localStorage.setItem("userData", JSON.stringify(user));
    alert("–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω. Resolve +3, XP +10");
    showTab('tasks');
}
</script>

</body>
</html>
